<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>俄罗斯方块游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .game-board {
            display: grid;
            grid-template-columns: repeat(10, 24px);
            grid-template-rows: repeat(20, 24px);
        }
        .cell {
            width: 24px;
            height: 24px;
            background-color: #ccc;
        }
        .cell.active {
            background-color: #00f;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4 text-center">俄罗斯方块</h1>
        <div class="flex flex-col md:flex-row gap-4">
            <div id="game" class="w-full md:w-1/2 bg-white p-2 rounded shadow"></div>
            <div class="w-full md:w-1/3 bg-white p-2 rounded shadow">
                <h2 class="text-xl font-semibold mb-2">控制</h2>
                <div class="flex flex-col space-y-2">
                    <button onclick="moveLeft()" class="px-3 py-1 bg-blue-500 text-white rounded">左</button>
                    <button onclick="moveRight()" class="px-3 py-1 bg-blue-500 text-white rounded">右</button>
                    <button onclick="rotate()" class="px-3 py-1 bg-blue-500 text-white rounded">旋转</button>
                    <button onclick="drop()" class="px-3 py-1 bg-blue-500 text-white rounded">下落</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const game = document.getElementById('game');
        const board = [];
        let currentPiece;
        let nextPiece;

        const colors = ['#ff6347', '#ffc155', '#90ee90', '#4682b4', '#a52a2a', '#ff69b4', '#87ceeb'];
        const shapes = [
            [[1, 1, 1, 1]], // I
            [[1, 1], [1, 1]], // O
            [[1, 1, 1], [0, 1, 0]], // T
            [[1, 1, 1], [1, 0, 0]], // L
            [[1, 1, 1], [0, 0, 1]], // J
            [[1, 1], [1, 1], [1, 1]], // S
            [[1, 1], [1, 1], [0, 1]] // Z
        ];

        function createBoard() {
            for (let i = 0; i < 20; i++) {
                board[i] = [];
                for (let j = 0; j < 10; j++) {
                    board[i][j] = 0;
                }
            }
        }

        function drawBoard() {
            game.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                for (let j = 0; j < 10; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (board[i][j] !== 0) {
                        cell.classList.add('active');
                    }
                    game.appendChild(cell);
                }
            }
        }

        function newPiece() {
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            currentPiece = {
                shape: shape,
                x: 3,
                y: 0,
                color: colors[Math.floor(Math.random() * colors.length)]
            };
        }

        function drawPiece() {
            const cells = currentPiece.shape.map((row, y) => row.map((val, x) => val ? [currentPiece.x + x, currentPiece.y + y] : null).flat().filter(cell => cell));
            cells.forEach(([x, y]) => {
                const cell = game.children[y * 10 + x];
                if (!cell.classList.contains('active')) {
                    cell.classList.add('active');
                }
            });
        }

        function moveLeft() {
            currentPiece.x--;
            if (collision()) {
                currentPiece.x++;
            }
            draw();
        }

        function moveRight() {
            currentPiece.x++;
            if (collision()) {
                currentPiece.x--;
            }
            draw();
        }

        function rotate() {
            const newShape = currentPiece.shape[0].map((_, i) => currentPiece.shape.map(row => row[i]).reverse());
            currentPiece.shape = newShape;
            if (collision()) {
                currentPiece.shape = currentPiece.shape[0].map((_, i) => currentPiece.shape.map(row => row[i]).reverse());
            }
            draw();
        }

        function drop() {
            while (!collision()) {
                currentPiece.y++;
            }
            currentPiece.y--;
            mergePiece();
            newPiece();
            draw();
            checkLine();
        }

        function collision() {
            for (let [x, y] of currentPiece.shape.flat()) {
                if (x + currentPiece.x < 0 || x + currentPiece.x >= 10 || y + currentPiece.y >= 20 || board[y + currentPiece.y][x + currentPiece.x] !== 0) {
                    return true;
                }
            }
            return false;
        }

        function mergePiece() {
            for (let [x, y] of currentPiece.shape.flat()) {
                board[y + currentPiece.y][x + currentPiece.x] = 1;
            }
        }

        function checkLine() {
            for (let y = 19; y >= 0; y--) {
                let full = true;
                for (let x = 0; x < 10; x++) {
                    if (board[y][x] === 0) {
                        full = false;
                        break;
                    }
                }
                if (full) {
                    for (let y2 = y; y2 > 0; y2--) {
                        board[y2] = [...board[y2 - 1]];
                    }
                    board[0] = Array(10).fill(0);
                }
            }
        }

        function draw() {
            drawBoard();
            drawPiece();
        }

        createBoard();
        newPiece();
        draw();

        // Auto drop every 500ms
        setInterval(() => {
            if (!collision()) {
                currentPiece.y++;
            } else {
                currentPiece.y--;
                mergePiece();
                newPiece();
                draw();
                checkLine();
            }
        }, 500);
    </script>
</body>
</html>