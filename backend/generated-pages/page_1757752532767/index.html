<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扫雷游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .cell {
            width: 10vw;
            height: 10vw;
            max-width: 48px;
            max-height: 48px;
            min-width: 32px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        .mine {
            background-color: #ef4444;
        }
        .flag {
            background-color: #fbbf24;
        }
        .revealed {
            background-color: #e5e7eb;
        }
        .hidden {
            background-color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-4 max-w-md">
        <h1 class="text-2xl font-bold text-center mb-4 text-gray-800">扫雷游戏</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center space-x-4">
                    <div class="text-lg font-semibold">
                        <span class="text-red-600">💣</span>
                        <span id="mineCount" class="ml-1">10</span>
                    </div>
                    <div class="text-lg font-semibold">
                        <span class="text-blue-600">⏱️</span>
                        <span id="timer" class="ml-1">000</span>
                    </div>
                </div>
                <button id="resetBtn" class="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors select-none">
                    新游戏
                </button>
            </div>
            
            <div class="flex justify-center mb-4">
                <select id="difficulty" class="border rounded-lg px-3 py-2 bg-white">
                    <option value="easy">简单 (9x9, 10雷)</option>
                    <option value="medium">中等 (16x16, 40雷)</option>
                    <option value="hard">困难 (16x30, 99雷)</option>
                </select>
            </div>
            
            <div id="gameBoard" class="grid gap-1 justify-center"></div>
        </div>
        
        <div class="text-center text-sm text-gray-600">
            <p>点击揭开方块，长按标记地雷</p>
        </div>
    </div>

    <script>
        let board = [];
        let revealed = [];
        let flagged = [];
        let gameOver = false;
        let firstClick = true;
        let mineCount = 10;
        let rows = 9;
        let cols = 9;
        let timer = 0;
        let timerInterval = null;

        const difficulties = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 }
        };

        function initGame() {
            const difficulty = document.getElementById('difficulty').value;
            const config = difficulties[difficulty];
            rows = config.rows;
            cols = config.cols;
            mineCount = config.mines;
            
            board = Array(rows).fill().map(() => Array(cols).fill(0));
            revealed = Array(rows).fill().map(() => Array(cols).fill(false));
            flagged = Array(rows).fill().map(() => Array(cols).fill(false));
            gameOver = false;
            firstClick = true;
            timer = 0;
            
            clearInterval(timerInterval);
            document.getElementById('timer').textContent = '000';
            document.getElementById('mineCount').textContent = mineCount;
            
            renderBoard();
        }

        function placeMines(excludeRow, excludeCol) {
            let minesPlaced = 0;
            while (minesPlaced < mineCount) {
                const row = Math.floor(Math.random() * rows);
                const col = Math.floor(Math.random() * cols);
                
                if (board[row][col] !== -1 && !(row === excludeRow && col === excludeCol)) {
                    board[row][col] = -1;
                    minesPlaced++;
                    
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            const newRow = row + dr;
                            const newCol = col + dc;
                            if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols && board[newRow][newCol] !== -1) {
                                board[newRow][newCol]++;
                            }
                        }
                    }
                }
            }
        }

        function renderBoard() {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell border border-gray-400 cursor-pointer hidden';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    updateCell(cell, row, col);
                    
                    cell.addEventListener('click', () => handleClick(row, col));
                    
                    let pressTimer;
                    cell.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        pressTimer = setTimeout(() => {
                            handleRightClick(row, col);
                        }, 500);
                    });
                    
                    cell.addEventListener('touchend', () => {
                        clearTimeout(pressTimer);
                    });
                    
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(row, col);
                    });
                    
                    gameBoard.appendChild(cell);
                }
            }
        }

        function updateCell(cell, row, col) {
            if (flagged[row][col]) {
                cell.className = 'cell border border-gray-400 cursor-pointer flag';
                cell.textContent = '🚩';
            } else if (revealed[row][col]) {
                cell.className = 'cell border border-gray-400 revealed';
                if (board[row][col] === -1) {
                    cell.classList.add('mine');
                    cell.textContent = '💣';
                } else if (board[row][col] > 0) {
                    const colors = ['', 'text-blue-600', 'text-green-600', 'text-red-600', 'text-purple-600', 'text-yellow-600', 'text-pink-600', 'text-black', 'text-gray-600'];
                    cell.classList.add(colors[board[row][col]]);
                    cell.textContent = board[row][col];
                }
            } else {
                cell.className = 'cell border border-gray-400 cursor-pointer hidden';
                cell.textContent = '';
            }
        }

        function handleClick(row, col) {
            if (gameOver || flagged[row][col] || revealed[row][col]) return;
            
            if (firstClick) {
                firstClick = false;
                placeMines(row, col);
                startTimer();
            }
            
            reveal(row, col);
            checkWin();
        }

        function handleRightClick(row, col) {
            if (gameOver || revealed[row][col]) return;
            
            flagged[row][col] = !flagged[row][col];
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            updateCell(cell, row, col);
            
            const flagCount = flagged.flat().filter(f => f).length;
            document.getElementById('mineCount').textContent = mineCount - flagCount;
        }

        function reveal(row, col) {
            if (row < 0 || row >= rows || col < 0 || col >= cols || revealed[row][col] || flagged[row][col]) {
                return;
            }
            
            revealed[row][col] = true;
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            updateCell(cell, row, col);
            
            if (board[row][col] === -1) {
                gameOver = true;
                clearInterval(timerInterval);
                revealAllMines();
                setTimeout(() => alert('游戏结束！'), 100);
            } else if (board[row][col] === 0) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        reveal(row + dr, col + dc);
                    }
                }
            }
        }

        function revealAllMines() {
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (board[row][col] === -1) {
                        revealed[row][col] = true;
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        updateCell(cell, row, col);
                    }
                }
            }
        }

        function checkWin() {
            let revealedCount = 0;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (revealed[row][col]) revealedCount++;
                }
            }
            
            if (revealedCount === rows * cols - mineCount) {
                gameOver = true;
                clearInterval(timerInterval);
                setTimeout(() => alert(`恭喜获胜！用时 ${timer} 秒`), 100);
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById('timer').textContent = timer.toString().padStart(3, '0');
            }, 1000);
        }

        document.getElementById('resetBtn').addEventListener('click', initGame);
        document.getElementById('difficulty').addEventListener('change', initGame);
        
        initGame();
    </script>
</body>
</html>